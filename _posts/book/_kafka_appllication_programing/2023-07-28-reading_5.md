---
title:  "[카프카] 카프카 스트림즈"
excerpt: "아파치 카프카 애플리케이션 프로그래밍 3장"
post-order: 7              

tag : ["kafka"]
sidebar:
  nav: "docs"
categories: ["book", "_kafka_application_programing"]


date: 2023-07-28
last_modified_at: 2023-07-28
---

# 5. 카프카 스트림즈

### 카프카 스트림즈

---

토픽에 적재된 데이터를 상태기반, 비상태기반으로 `실시간 변환하여 다른 토픽에 적재`하는 라이브러리

- 오픈소스 : Apache Spark, Apache Flink, Apache Storm, Fluentd, Kafka Streams

왜 Kafka Streams를 쓰는가?

- Kafka Streams는 Kafka에서 공식적으로 지원하는 라이브러리.
- Kafka 버전이 오를때마다 같이 릴리즈된다.
- 자바 기반 스트림즈 애플리케이션은 카프카 클러스터와 완벽히 호환되며, 스트림 처리에 필요한 기능들을 제공
  - 토픽 생성 / 상태저장 / 데이터 조인 등..
- 브로커, 스프림즈 애플리케이션이 장애가 나도 `정확히 한번` 동작할수 있도록 동작하여 안정성이 뛰어나다.

```java
보통 빅테이터 처리에 필수적이라 판단되었던 "분산시스템", "스케줄링 프로그램"들은 스트림즈를 운용하는데 불필요하다
- 스트림즈 애플리케이션은 JVM위에서 하나의 프로세스로 실행되기 때문
```

### 스트림즈 애플리케이션

---

1. 내부적으로 `스레드`를 1개 이상 생성할수 있다.
2. `스레드`는 1개 이상의 `테스크`를 가진다
  1. 테스크 : 스트림즈 애플리케이션의 데이터 처리 최소 단위

3개 파티션으로 구성된 토픽을 처리하는 스트림즈 애플리케이션을 실행하면 내부에 3개의 태스크가 생긴다.

- 처리량을 높이기 위해 컨슈머 스레드를 늘리는 방법과 동일하게 `파티션과 스트림즈 스레드 개수를 늘림`으로써 처리량을 늘릴수 있다.

### 카프카 스트림즈의 토폴로지

---

- 프로세서 : 토폴로지를 이루는 노드
- 스트림 : 노드와 노드를 이은 선
  - 토픽의 레코드

![Untitled](https://drive.google.com/uc?export=view&id=1D5z8fLw6krGLvhOTMnjy3ep55GTEYcDp)

### 카프카 스트림즈 프로세서 종류

---

1. 소스 프로세서
  - 데이터를 처리하기위해 최초로 선언해야 하는 노드. 하나이상의 토픽에서 레코드를 가져오는 역할
2. 스트림 프로세서
  - 다른 프로세서가 반환한 데이터를 처리하는 역할
  - 분기처리 가능
3. 싱크 프로세서
  - 레코드를 특정 카프카 토픽으로 저장하는 역할
  - 스트림즈 처리된 데이터의 최종 종착지

### 카프카 스트림즈 개발 방법

---

1. 스트림즈DSL
  - 메세지 값을 기반으로 토픽 분기 처리
  - 지난 10분간 들어온 데이터 개수 집계
  - 토픽과 다른 토픽의 결합으로 새로운 데이터 생성

1. 프로세서API
  - 메세지 값의 종류에 따라 토픽을 가변적으로 전송
  - 일정한 시간 간격으로 데이터 처리